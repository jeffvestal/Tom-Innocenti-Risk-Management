# Innocenti Risk Management - Enablement Kit

A field engineering enablement kit demonstrating the **"Full Chain" search pipeline** using **Jina AI models** on **Elastic Inference Service (EIS)**.

## The Scenario

We're simulating a high-stakes legal compliance firm called **"Innocenti & Associates"** that needs to search the **EU AI Act** with precision. Standard search fails on legal nuance -- we fix that with a complete pipeline:

1. **Jina Reader** → Converts messy PDFs to clean markdown
2. **Jina Embeddings v3** → Multilingual semantic understanding
3. **Jina Reranker v3** → Listwise precision (the "Lawyer's Brain")
4. **Jina VLM** → Vision Language Model that audits architecture diagrams for compliance risks

## Project Structure

The kit has two parts: **Python notebooks** for the data pipeline and a **Next.js UI** for the interactive demo.

```
├── notebooks/                   # Part 1: Data Pipeline (Python)
│   ├── 01_ingest.ipynb          #   PDF → Structured JSON via Jina Reader
│   ├── 02_index.ipynb           #   Index with semantic_text + EIS
│   ├── 03_rerank.ipynb          #   Demonstrate Listwise Reranking
│   └── utils/
│       └── credentials.py       #   Shared credential management
├── data/
│   └── eu_ai_act_clean.json     #   Generated by Notebook 01
│
├── ui/                          # Part 2: Interactive Demo (Next.js)
│   ├── app/
│   │   ├── page.tsx             #   Main search page
│   │   └── api/
│   │       ├── search/          #   Elasticsearch semantic search + reranking
│   │       └── vision/          #   Jina VLM diagram auditor
│   ├── components/              #   SearchBar, ResultsList, VlmAuditPanel, etc.
│   ├── lib/elasticsearch.ts     #   ES client + search functions
│   └── scripts/
│       └── setup-demo-index.ts  #   Index creation + data loading
│
└── requirements.txt             # Python dependencies
```

## Key Concepts Demonstrated

| Layer | Concept | Jina Product |
|-------|---------|--------------|
| Notebook 01 | PDF parsing without OCR | Jina Reader (ReaderLM) |
| Notebook 02 | Zero-config embeddings | Jina Embeddings v3 via EIS |
| Notebook 03 | Listwise reranking | Jina Reranker v3 via EIS |
| UI - Text Search | Semantic search + reranking | Jina Embeddings v3 + Reranker v3 via EIS |
| UI - Diagram Auditor | Architecture diagram analysis | Jina VLM (Vision Language Model) |

## Prerequisites

- Python 3.9+
- Node.js 18+
- Elastic Cloud account with API key
- Jina AI API key ([get one here](https://jina.ai/))

## Credentials

All three values are used by both the notebooks and the UI:

| Variable | Description |
|----------|-------------|
| `ELASTIC_CLOUD_ID` | Your Elastic Cloud deployment ID |
| `ELASTIC_API_KEY` | API key with index/search permissions |
| `JINA_API_KEY` | Jina AI API key |

**Notebooks:** Prompted via `getpass` on first run. Optionally save to a root `.env` file for persistence (never committed to git).

**UI:** Stored in `ui/.env.local` (copy from `ui/.env.local.example`).

---

## Part 1: Notebooks (Data Pipeline)

### Setup

```bash
pip install -r requirements.txt
```

### Run the notebooks in order

1. **`01_ingest.ipynb`** - Fetches the EU AI Act PDF, cleans it, outputs JSON
2. **`02_index.ipynb`** - Creates Elastic index with `semantic_text`, bulk indexes data
3. **`03_rerank.ipynb`** - Demonstrates raw retrieval vs. reranked results

Each notebook prompts for credentials on first run. Save to `.env` for persistence across sessions.

---

## Part 2: UI (Interactive Demo)

### Setup

```bash
cd ui
npm install
cp .env.local.example .env.local   # then fill in credentials
```

### First-time data setup

If you haven't already loaded data via the notebooks, you can use the UI setup script:

```bash
npm run setup
```

This creates the search index, fetches the EU AI Act via Jina Reader, and indexes all articles.

### Start the dev server

```bash
npm run dev
```

Open [http://localhost:3000](http://localhost:3000).

### UI Features

**Text Search**
1. Enter a query like "biometric identification" or "law enforcement facial recognition"
2. View the top 10 semantically similar articles
3. Click "Deep Analysis" to trigger reranking with Jina Reranker v3
4. Compare results with movement indicators showing ranking changes

**Visual Diagram Auditor**
1. Click the image icon next to the search bar and select an architecture diagram
2. Jina VLM analyzes the diagram and produces a detailed data-flow summary
3. Read the VLM Audit Report in the collapsible panel above results
4. The analysis is automatically used as a search query to surface relevant EU AI Act articles
5. Optionally click "Deep Analysis" to rerank the results

> **Note:** The Jina VLM has a ~45-second cold start after idle periods. The first upload may take up to a minute. If it fails, wait 30 seconds and try again.

### UI Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                        Browser                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  React Components (Search, Results, Comparison View)     │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                     Next.js Server                               │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  /api/search  - Proxies to Elasticsearch                 │   │
│  │  /api/vision  - Calls Jina VLM for diagram analysis     │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      Elastic Cloud                               │
│  ┌──────────────────┐  ┌──────────────┐  ┌─────────────────┐   │
│  │ search-eu-ai-act │  │ Jina Embed   │  │ Jina Reranker   │   │
│  │ (semantic_text)  │  │ v3 (EIS)     │  │ v3 (EIS)        │   │
│  └──────────────────┘  └──────────────┘  └─────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

### UI Scripts

| Command | Description |
|---------|-------------|
| `npm run setup` | Create index and load data (idempotent) |
| `npm run dev` | Start development server |
| `npm run build` | Build for production |
| `npm run start` | Start production server |

### Sample Queries

- `"Can law enforcement use facial recognition?"` - Reranking surfaces specific exceptions
- `"biometric identification systems"` - Compare general vs specific matches
- `"AI system risk categories"` - See how articles are reordered by relevance

---

## Tech Stack

| Component | Technology |
|-----------|------------|
| Notebooks | Python, Jupyter |
| UI Framework | Next.js 14 (App Router) |
| Styling | Tailwind CSS (dark theme) |
| Icons | Lucide React |
| Search Backend | Elasticsearch with `semantic_text` |
| AI Models | Jina Reader, Embeddings v3, Reranker v3, VLM |

## Troubleshooting

**"Search index not found"** - Run `npm run setup` (from `ui/`) to create the index and load data.

**"Elasticsearch not configured"** - Ensure `ui/.env.local` exists with valid `ELASTIC_CLOUD_ID` and `ELASTIC_API_KEY`.

**"Jina Reader empty response"** - The PDF fetch sometimes needs retries. The setup script handles this automatically, but you may need to run it again.

**Vision Diagram Auditor times out** - The Jina VLM has a ~45s cold start after idle periods. The API route retries automatically (up to 3 attempts). If it still fails, wait 30 seconds and try again. Ensure `JINA_API_KEY` is set in `ui/.env.local`.

## License

MIT
